<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>进程 | Epoch</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="./assets/img/logo.ico">
    <meta name="description" content="Epoch&#39;s Blog">
    <meta name="author" content="Epoch">
    <meta name="keywords" content="Epochs Blog Basted On VuePress.">
    
    <link rel="preload" href="/blog/assets/css/0.styles.19413b44.css" as="style"><link rel="preload" href="/blog/assets/js/app.a976d4b9.js" as="script"><link rel="preload" href="/blog/assets/js/2.077fc20b.js" as="script"><link rel="preload" href="/blog/assets/js/24.9b3b0f9c.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.c59a72b7.js"><link rel="prefetch" href="/blog/assets/js/11.2f51997e.js"><link rel="prefetch" href="/blog/assets/js/12.4c6b6d39.js"><link rel="prefetch" href="/blog/assets/js/13.8c9bf63c.js"><link rel="prefetch" href="/blog/assets/js/14.375a22b6.js"><link rel="prefetch" href="/blog/assets/js/15.630ac74c.js"><link rel="prefetch" href="/blog/assets/js/16.f9efd192.js"><link rel="prefetch" href="/blog/assets/js/17.710968ef.js"><link rel="prefetch" href="/blog/assets/js/18.e98248c3.js"><link rel="prefetch" href="/blog/assets/js/19.4dca1550.js"><link rel="prefetch" href="/blog/assets/js/20.ed86343f.js"><link rel="prefetch" href="/blog/assets/js/21.501b2f8f.js"><link rel="prefetch" href="/blog/assets/js/22.d3b58b1c.js"><link rel="prefetch" href="/blog/assets/js/23.9bf8a256.js"><link rel="prefetch" href="/blog/assets/js/25.2f925885.js"><link rel="prefetch" href="/blog/assets/js/26.1bf62e76.js"><link rel="prefetch" href="/blog/assets/js/27.3f7bc42a.js"><link rel="prefetch" href="/blog/assets/js/28.8bb4c4dd.js"><link rel="prefetch" href="/blog/assets/js/29.c6ffb896.js"><link rel="prefetch" href="/blog/assets/js/3.87def374.js"><link rel="prefetch" href="/blog/assets/js/30.98fc8e51.js"><link rel="prefetch" href="/blog/assets/js/31.7f306c76.js"><link rel="prefetch" href="/blog/assets/js/32.bf1c9517.js"><link rel="prefetch" href="/blog/assets/js/33.7e1a42c9.js"><link rel="prefetch" href="/blog/assets/js/34.49813caa.js"><link rel="prefetch" href="/blog/assets/js/35.8e496e16.js"><link rel="prefetch" href="/blog/assets/js/36.c394458b.js"><link rel="prefetch" href="/blog/assets/js/37.409d9fcc.js"><link rel="prefetch" href="/blog/assets/js/38.4970fb9b.js"><link rel="prefetch" href="/blog/assets/js/4.4e1a7e2a.js"><link rel="prefetch" href="/blog/assets/js/5.f2ca250f.js"><link rel="prefetch" href="/blog/assets/js/6.db1d3ebc.js"><link rel="prefetch" href="/blog/assets/js/7.5a85f1a5.js"><link rel="prefetch" href="/blog/assets/js/8.1dbfb293.js"><link rel="prefetch" href="/blog/assets/js/9.168f1830.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.19413b44.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="./assets/img/logo.png" alt="Epoch" class="logo"> <span class="site-name can-hide">Epoch</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/CPP/C++ Primer.html" class="nav-link">
  CPP
</a></div><div class="nav-item"><a href="/blog/MySQL/" class="nav-link">
  MySQL
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Internet" class="dropdown-title"><span class="title">Internet</span> <span class="arrow down"></span></button> <button type="button" aria-label="Internet" class="mobile-dropdown-title"><span class="title">Internet</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Internet/Frame.html" class="nav-link">
  Frame
</a></li><li class="dropdown-item"><!----> <a href="/blog/Internet/HTTP/Http.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/blog/Internet/TCP&amp;IP/IP.html" class="nav-link">
  TCP&amp;IP
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="others" class="dropdown-title"><span class="title">others</span> <span class="arrow down"></span></button> <button type="button" aria-label="others" class="mobile-dropdown-title"><span class="title">others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/others/Git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/Binary Tree Traversal.html" class="nav-link">
  Binary Tree Traversal
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/CPP/C++ Primer.html" class="nav-link">
  CPP
</a></div><div class="nav-item"><a href="/blog/MySQL/" class="nav-link">
  MySQL
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Internet" class="dropdown-title"><span class="title">Internet</span> <span class="arrow down"></span></button> <button type="button" aria-label="Internet" class="mobile-dropdown-title"><span class="title">Internet</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Internet/Frame.html" class="nav-link">
  Frame
</a></li><li class="dropdown-item"><!----> <a href="/blog/Internet/HTTP/Http.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/blog/Internet/TCP&amp;IP/IP.html" class="nav-link">
  TCP&amp;IP
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="others" class="dropdown-title"><span class="title">others</span> <span class="arrow down"></span></button> <button type="button" aria-label="others" class="mobile-dropdown-title"><span class="title">others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/others/Git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/Binary Tree Traversal.html" class="nav-link">
  Binary Tree Traversal
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/Linux/" aria-current="page" class="sidebar-link">Linux</a></li><li><a href="/blog/Linux/GDB调试.html" class="sidebar-link">GDB调试</a></li><li><a href="/blog/Linux/Linux网络编程.html" class="sidebar-link">网络编程</a></li><li><a href="/blog/Linux/Makefile.html" class="sidebar-link">Makefile</a></li><li><a href="/blog/Linux/Shell.html" class="sidebar-link">Shell Script File</a></li><li><a href="/blog/Linux/进程.html" class="active sidebar-link">进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/Linux/进程.html#相关概念" class="sidebar-link">相关概念</a></li><li class="sidebar-sub-header"><a href="/blog/Linux/进程.html#进程管理" class="sidebar-link">进程管理</a></li><li class="sidebar-sub-header"><a href="/blog/Linux/进程.html#进程状态转移" class="sidebar-link">进程状态转移</a></li><li class="sidebar-sub-header"><a href="/blog/Linux/进程.html#进程创建及父子进程调试" class="sidebar-link">进程创建及父子进程调试</a></li><li class="sidebar-sub-header"><a href="/blog/Linux/进程.html#exec-函数族" class="sidebar-link">exec 函数族</a></li></ul></li><li><a href="/blog/Linux/静态库和动态库.html" class="sidebar-link">Linux 静态库和动态库</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="进程"><a href="#进程" class="header-anchor">#</a> 进程</h1> <blockquote><p>进程是程序的一个实例</p></blockquote> <ol><li>单道程序：内存中只能运行一个程序</li> <li>多道程序：多个程序穿插运行，有利于提高CPU利用率</li></ol> <h2 id="相关概念"><a href="#相关概念" class="header-anchor">#</a> 相关概念</h2> <h3 id="时间片"><a href="#时间片" class="header-anchor">#</a> 时间片</h3> <blockquote><p>由操作系统内核分配给每个进程。首先，内核会给每个进程分配相同初始时间片， 当所有进程都处于时间片耗尽，重新分配时间片。</p></blockquote> <h3 id="并发与并行"><a href="#并发与并行" class="header-anchor">#</a> 并发与并行</h3> <blockquote><p>并行（parallel): 同一时刻， 多条指令在多个处理器上同时执行。</p> <p>并发：指同一时刻，只能有一个一条指令。多个进程快速交替执行。</p></blockquote> <h3 id="进程号和相关函数"><a href="#进程号和相关函数" class="header-anchor">#</a> 进程号和相关函数</h3> <blockquote><p>每个进程都是一个唯一的进程号，<code>pid_t</code>类型， 范围<code>0-32767</code></p></blockquote> <ul><li><p>每个进程（除了init）都是由另一个进程创建，父进程创建子进程，父进程的<code>pid_t</code>为称为<code>PPID</code></p></li> <li><p>进程组是一个或多个进程的集合。关联的进程号有一个进程组号<code>PGID</code>.默认情况下，当前进程号当作当前进程组号。</p></li> <li><p>相关函数</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token class-name">pid_t</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">pid_t</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">pid_t</span> <span class="token function">getpgid</span><span class="token punctuation">(</span><span class="token class-name">pid_t</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="进程管理"><a href="#进程管理" class="header-anchor">#</a> 进程管理</h2> <blockquote><p>PCB(Processing Control Block)，进程控制块，维护进程相关的信息</p></blockquote> <ul><li>进程id：用pit_t类型表示</li> <li>进程的状态：就绪、运行、挂起、停止等状态</li> <li>进程切换时需要保存和恢复的一些CPU寄存器</li> <li>描述虚拟地址空间的信息</li> <li>描述控制终端的信息</li> <li>当前工作目录</li> <li>umask掩码</li> <li>文件描述符，包含很多指向file结构体的指针</li> <li>用户id和组id</li> <li>会话（Session）和进程组</li> <li>进程可以适用的资源上限（Rescource Limit）</li></ul> <h2 id="进程状态转移"><a href="#进程状态转移" class="header-anchor">#</a> 进程状态转移</h2> <blockquote><p>三态模型：就绪、运行、阻塞</p> <p>五态模型：新建、就绪、运行、阻塞、终止</p></blockquote> <h3 id="查看进程"><a href="#查看进程" class="header-anchor">#</a> 查看进程</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">ps</span> aux / ajx
</code></pre></div><ul><li>STAT 相关参数含义（查吧）</li> <li>实时显示进程动态</li></ul> <h3 id="杀死进程"><a href="#杀死进程" class="header-anchor">#</a> 杀死进程</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">kill</span> <span class="token punctuation">[</span>-signal<span class="token punctuation">]</span> pid
<span class="token function">kill</span> -l <span class="token comment">#列出所有信号</span>
<span class="token function">kill</span> -9 pid<span class="token comment"># or -SIGKILL </span>
</code></pre></div><h2 id="进程创建及父子进程调试"><a href="#进程创建及父子进程调试" class="header-anchor">#</a> 进程创建及父子进程调试</h2> <ol><li><p><code>pid_t fork(void)</code> 创建进程。 pid_t 本质是int。</p> <div class="language-C extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys.types.h&gt;</span> <span class="token comment">//宏文件</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span> <span class="token comment">//std unix</span></span>
<span class="token class-name">pid_t</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">/*
return: 成功返回pid &gt;= 0
		失败返回-1
		返回值会返回两次，一次是父进程（pid &gt; 0），一次在子进程。(pid = 0)
		
失败原因：
	1. 进程数到达上限。 errno被设置为EAGAIN
	2. 系统内存不足。errno被设置为ENOMEM
	
原理： 
	1.写时候拷贝（copy-on-write）
	2.只有写的时候才拷贝，否则共享地址和文件
*/</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//父进程</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I am parent process, pid %d, ppid: %d&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 子进程</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I am child process, pid %d, ppid: %d&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>父子进程的异同</p> <ol><li>不同点
<ol><li><code>pid = fork()</code>值不同</li> <li>PCB内容不同： pid、ppid不同、信号集</li></ol></li> <li>相同点
<ol><li>无写入的情况下，用户区的数据，文件描述符共享</li></ol></li></ol></li> <li><p>GDB多进程调试</p> <ol><li><p>设置调试模式：子进程还是父进程</p> <div class="language-bash extra-class"><pre class="language-bash"><code>show follow-fork-mode
<span class="token builtin class-name">set</span> follow-fork-mode <span class="token punctuation">[</span>child <span class="token operator">|</span> parent<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>设置调试模式：调试当前程序时，其他程序是否运行</p> <div class="language-shell extra-class"><pre class="language-shell"><code>show detach-on-fork
<span class="token builtin class-name">set</span> detach-on-fork <span class="token punctuation">[</span>on <span class="token operator">|</span> off<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>其他命令</p> <div class="language-shell extra-class"><pre class="language-shell"><code>info inferiors //查看调试进程
inferior <span class="token function">id</span> //切换调试进程
detach inferiors <span class="token function">id</span> //使进程分离
</code></pre></div></li></ol></li></ol> <h2 id="exec-函数族"><a href="#exec-函数族" class="header-anchor">#</a> exec 函数族</h2> <blockquote><p>功能相同或者相似的一系列函数。</p></blockquote> <h3 id="作用"><a href="#作用" class="header-anchor">#</a> 作用</h3> <p>根据指定文件路径，找到并执行，用它来取代调用进程的内容。即，在调用进程内部执行一个可执行文件。</p> <h3 id="返回值"><a href="#返回值" class="header-anchor">#</a> 返回值</h3> <blockquote><p>成功的话无返回值，失败返回-1</p></blockquote> <p>因为调用进程的实体，包括代码段，数据段和堆栈等都已经被新的内容取代，只留下进程ID等一些表面信息保持原样。失败原代码段才存在，才能接收-1。</p> <h3 id="相关函数"><a href="#相关函数" class="header-anchor">#</a> 相关函数</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">execl</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//absolute path</span>
<span class="token keyword">int</span> <span class="token function">execlp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> file<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//会找系统环境变量</span>
<span class="token keyword">int</span> <span class="token function">execv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">execvp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">execvpe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">execve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
l(list) 参数地址列表， 以空指针结尾
v(vector) 存有各参数地址的指针数组的地址。
p(path) 按PATH环境变量指定的目录搜索
e(environment) 按有环境变量字符串地址的指针数组的地址。
*/</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/6/2022, 8:59:12 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/Linux/Shell.html" class="prev">
        Shell Script File
      </a></span> <span class="next"><a href="/blog/Linux/静态库和动态库.html">
        Linux 静态库和动态库
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a976d4b9.js" defer></script><script src="/blog/assets/js/2.077fc20b.js" defer></script><script src="/blog/assets/js/24.9b3b0f9c.js" defer></script>
  </body>
</html>
