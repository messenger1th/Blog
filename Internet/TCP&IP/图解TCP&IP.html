<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>图解TCP/IP | Epoch</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="./assets/img/logo.ico">
    <meta name="description" content="Epoch&#39;s Blog">
    <meta name="author" content="Epoch">
    <meta name="keywords" content="Epochs Blog Basted On VuePress.">
    
    <link rel="preload" href="/blog/assets/css/0.styles.19413b44.css" as="style"><link rel="preload" href="/blog/assets/js/app.a976d4b9.js" as="script"><link rel="preload" href="/blog/assets/js/2.077fc20b.js" as="script"><link rel="preload" href="/blog/assets/js/17.710968ef.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.c59a72b7.js"><link rel="prefetch" href="/blog/assets/js/11.2f51997e.js"><link rel="prefetch" href="/blog/assets/js/12.4c6b6d39.js"><link rel="prefetch" href="/blog/assets/js/13.8c9bf63c.js"><link rel="prefetch" href="/blog/assets/js/14.375a22b6.js"><link rel="prefetch" href="/blog/assets/js/15.630ac74c.js"><link rel="prefetch" href="/blog/assets/js/16.f9efd192.js"><link rel="prefetch" href="/blog/assets/js/18.e98248c3.js"><link rel="prefetch" href="/blog/assets/js/19.4dca1550.js"><link rel="prefetch" href="/blog/assets/js/20.ed86343f.js"><link rel="prefetch" href="/blog/assets/js/21.501b2f8f.js"><link rel="prefetch" href="/blog/assets/js/22.d3b58b1c.js"><link rel="prefetch" href="/blog/assets/js/23.9bf8a256.js"><link rel="prefetch" href="/blog/assets/js/24.9b3b0f9c.js"><link rel="prefetch" href="/blog/assets/js/25.2f925885.js"><link rel="prefetch" href="/blog/assets/js/26.1bf62e76.js"><link rel="prefetch" href="/blog/assets/js/27.3f7bc42a.js"><link rel="prefetch" href="/blog/assets/js/28.8bb4c4dd.js"><link rel="prefetch" href="/blog/assets/js/29.c6ffb896.js"><link rel="prefetch" href="/blog/assets/js/3.87def374.js"><link rel="prefetch" href="/blog/assets/js/30.98fc8e51.js"><link rel="prefetch" href="/blog/assets/js/31.7f306c76.js"><link rel="prefetch" href="/blog/assets/js/32.bf1c9517.js"><link rel="prefetch" href="/blog/assets/js/33.7e1a42c9.js"><link rel="prefetch" href="/blog/assets/js/34.49813caa.js"><link rel="prefetch" href="/blog/assets/js/35.8e496e16.js"><link rel="prefetch" href="/blog/assets/js/36.c394458b.js"><link rel="prefetch" href="/blog/assets/js/37.409d9fcc.js"><link rel="prefetch" href="/blog/assets/js/38.4970fb9b.js"><link rel="prefetch" href="/blog/assets/js/4.4e1a7e2a.js"><link rel="prefetch" href="/blog/assets/js/5.f2ca250f.js"><link rel="prefetch" href="/blog/assets/js/6.db1d3ebc.js"><link rel="prefetch" href="/blog/assets/js/7.5a85f1a5.js"><link rel="prefetch" href="/blog/assets/js/8.1dbfb293.js"><link rel="prefetch" href="/blog/assets/js/9.168f1830.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.19413b44.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="./assets/img/logo.png" alt="Epoch" class="logo"> <span class="site-name can-hide">Epoch</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/CPP/C++ Primer.html" class="nav-link">
  CPP
</a></div><div class="nav-item"><a href="/blog/MySQL/" class="nav-link">
  MySQL
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Internet" class="dropdown-title"><span class="title">Internet</span> <span class="arrow down"></span></button> <button type="button" aria-label="Internet" class="mobile-dropdown-title"><span class="title">Internet</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Internet/Frame.html" class="nav-link">
  Frame
</a></li><li class="dropdown-item"><!----> <a href="/blog/Internet/HTTP/Http.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/blog/Internet/TCP&amp;IP/IP.html" class="nav-link">
  TCP&amp;IP
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="others" class="dropdown-title"><span class="title">others</span> <span class="arrow down"></span></button> <button type="button" aria-label="others" class="mobile-dropdown-title"><span class="title">others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/others/Git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/Binary Tree Traversal.html" class="nav-link">
  Binary Tree Traversal
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/CPP/C++ Primer.html" class="nav-link">
  CPP
</a></div><div class="nav-item"><a href="/blog/MySQL/" class="nav-link">
  MySQL
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Internet" class="dropdown-title"><span class="title">Internet</span> <span class="arrow down"></span></button> <button type="button" aria-label="Internet" class="mobile-dropdown-title"><span class="title">Internet</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Internet/Frame.html" class="nav-link">
  Frame
</a></li><li class="dropdown-item"><!----> <a href="/blog/Internet/HTTP/Http.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/blog/Internet/TCP&amp;IP/IP.html" class="nav-link">
  TCP&amp;IP
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="others" class="dropdown-title"><span class="title">others</span> <span class="arrow down"></span></button> <button type="button" aria-label="others" class="mobile-dropdown-title"><span class="title">others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/others/Git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/Binary Tree Traversal.html" class="nav-link">
  Binary Tree Traversal
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>TCP&amp;IP</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/Internet/TCP&amp;IP/" aria-current="page" class="sidebar-link">Internet</a></li><li><a href="/blog/Internet/TCP&amp;IP/IP.html" class="sidebar-link">IP地址</a></li><li><a href="/blog/Internet/TCP&amp;IP/Question.html" class="sidebar-link">为什么需要三次握手?</a></li><li><a href="/blog/Internet/TCP&amp;IP/TCP.html" class="sidebar-link">TCP</a></li><li><a href="/blog/Internet/TCP&amp;IP/图解TCP&amp;IP.html" class="active sidebar-link">图解TCP/IP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/Internet/TCP&amp;IP/图解TCP&amp;IP.html#第3章-数据链路" class="sidebar-link">第3章 数据链路</a></li><li class="sidebar-sub-header"><a href="/blog/Internet/TCP&amp;IP/图解TCP&amp;IP.html#第6章-tcp与udp" class="sidebar-link">第6章 TCP与UDP</a></li><li class="sidebar-sub-header"><a href="/blog/Internet/TCP&amp;IP/图解TCP&amp;IP.html#第七章-路由控制" class="sidebar-link">第七章: 路由控制</a></li><li class="sidebar-sub-header"><a href="/blog/Internet/TCP&amp;IP/图解TCP&amp;IP.html#第八章-应用协议" class="sidebar-link">第八章: 应用协议</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="图解tcp-ip"><a href="#图解tcp-ip" class="header-anchor">#</a> 图解TCP/IP</h1> <p>NAT/ NAPT技术: 本地通信时采用私有IP, 与互联网通信时使用该技术转成公有IP</p> <ul><li>起因: 解决IPv4 IP地址不够用</li></ul> <p>IP隧道技术: 这种在网络层的首部后面继续追加网络层首部的通信方法</p> <ul><li>起因: IPv4和IPv6不兼容</li> <li>扩展应用: IP隧道转发多播消息</li></ul> <p>Mobile IP: 在主机所连接的子网IP发 生变化时，主机IP地址仍保持不变。</p> <ul><li>起因: 与移动设备进行通信时，所连接的子网一旦发生变化，则无法通过 TCP继续通信。</li></ul> <h2 id="第3章-数据链路"><a href="#第3章-数据链路" class="header-anchor">#</a> 第3章 数据链路</h2> <ol><li>MAC地址: Media access control</li></ol> <h2 id="第6章-tcp与udp"><a href="#第6章-tcp与udp" class="header-anchor">#</a> 第6章 TCP与UDP</h2> <h3 id="tcp-面向有连接-是一对一可靠性传输"><a href="#tcp-面向有连接-是一对一可靠性传输" class="header-anchor">#</a> TCP: 面向有连接, 是一对一可靠性传输</h3> <ol><li>校验和</li> <li>序列号</li> <li>确认应答</li> <li>重发控制</li> <li>连接管理</li> <li>窗口控制</li></ol> <p>以上, 实现了可靠性传输.</p> <h4 id="三次握手-四次挥手"><a href="#三次握手-四次挥手" class="header-anchor">#</a> 三次握手, 四次挥手</h4> <p><strong>三次握手: 验证各自的接收能力和发送能力</strong></p> <ol><li><p>第一次握手：客户端给服务端发一个 SYN 报文，并指明客户端的初始化序列号 ISN。此时客户端处于 <code>SYN_SENT</code> 状态。</p> <p>首部的同步位SYN=1，初始序号seq=x，SYN=1的报文段不能携带数据，但要消耗掉一个序号。</p></li> <li><p>第二次握手：服务器收到客户端的 SYN 报文之后，会以自己的 SYN 报文作为应答，并且也是指定了自己的初始化序列号 ISN(s)。同时会把客户端的 ISN + 1 作为ACK 的值，表示自己已经收到了客户端的 SYN，此时服务器处于 <code>SYN_RCVD</code> 的状态。</p> <p>在确认报文段中SYN=1，ACK=1，确认号ack=x+1，初始序号seq=y。</p></li> <li><p>第三次握手：客户端收到 SYN 报文之后，会发送一个 ACK 报文，当然，也是一样把服务器的 ISN + 1 作为 ACK 的值，表示已经收到了服务端的 SYN 报文，此时客户端处于 <code>ESTABLISHED</code> 状态。服务器收到 ACK 报文之后，也处于 <code>ESTABLISHED</code> 状态，此时，双方已建立起了连接。</p> <p>确认报文段ACK=1，确认号ack=y+1，序号seq=x+1（初始为seq=x，第二个报文段所以要+1），ACK报文段可以携带数据，不携带数据则不消耗序号。</p></li></ol> <p><strong>四次挥手</strong>:当连接处于<code>半关闭状态</code>时，TCP 是允许单向传输数据的.</p> <ul><li>第一次挥手：客户端发送一个 FIN 报文，报文中会指定一个序列号。此时客户端处于 <code>FIN_WAIT1</code> 状态。
即发出<strong>连接释放报文段</strong>（FIN=1，序号seq=u），并停止再发送数据，主动关闭TCP连接，进入FIN_WAIT1（终止等待1）状态，等待服务端的确认。</li> <li>第二次挥手：服务端收到 FIN 之后，会发送 ACK 报文，且把客户端的序列号值 +1 作为 ACK 报文的序列号值，表明已经收到客户端的报文了，此时服务端处于 <code>CLOSE_WAIT</code> 状态。
即服务端收到连接释放报文段后即发出<strong>确认报文段</strong>（ACK=1，确认号ack=u+1，序号seq=v），服务端进入CLOSE_WAIT（关闭等待）状态，此时的TCP处于半关闭状态，客户端到服务端的连接释放。客户端收到服务端的确认后，进入FIN_WAIT2（终止等待2）状态，等待服务端发出的连接释放报文段。</li> <li>第三次挥手：如果服务端也想断开连接了，和客户端的第一次挥手一样，发给 FIN 报文，且指定一个序列号。此时服务端处于 <code>LAST_ACK</code> 的状态。
即服务端没有要向客户端发出的数据，服务端发出<strong>连接释放报文段</strong>（FIN=1，ACK=1，序号seq=w，确认号ack=u+1），服务端进入LAST_ACK（最后确认）状态，等待客户端的确认。</li> <li>第四次挥手：客户端收到 FIN 之后，一样发送一个 ACK 报文作为应答，且把服务端的序列号值 +1 作为自己 ACK 报文的序列号值，此时客户端处于 <code>TIME_WAIT</code> 状态。需要过一阵子以确保服务端收到自己的 ACK 报文之后才会进入 CLOSED 状态，服务端收到 ACK 报文之后，就处于关闭连接了，处于 <code>CLOSED</code> 状态。
即客户端收到服务端的连接释放报文段后，对此发出<strong>确认报文段</strong>（ACK=1，seq=u+1，ack=w+1），客户端进入TIME_WAIT（时间等待）状态。此时TCP未释放掉，需要经过时间等待计时器设置的时间2MSL后，客户端才进入CLOSED状态。</li></ul> <h2 id="第七章-路由控制"><a href="#第七章-路由控制" class="header-anchor">#</a> 第七章: 路由控制</h2> <ol><li><p>动态路由和静态路由</p></li> <li><p>路由协议IGP 和 EGP(Internal Gateway Protocol, External Gateway Protocol)</p></li> <li><p>路由算法: 距离向量算法, 链路状态算法</p></li> <li><p>RIP, RIP2, OSPF</p></li> <li><p>BGP</p></li></ol> <h3 id="rip-routine-information-protocol"><a href="#rip-routine-information-protocol" class="header-anchor">#</a> RIP(Routine Information Protocol)</h3> <blockquote><p>是距离向量型的一种路由协议, 广泛应用于LAN口.</p></blockquote> <p>采用RIP进行路由控制的范围内必须注意两点</p> <ol><li>因IP 地址的分类而产生不同的网络地址</li> <li>构造网络地址长度不同的 网络环境时</li></ol> <p>RIP中路由变更时的处理:</p> <ol><li>将自己所知道的路由信息定期进行广播。</li> <li>一旦认为网络被断开，数据将无法流过此路由器，其他路由器也就 可以得知网络已经断开。</li></ol> <p>以上两点存在一些问题, 解决办法</p> <ol><li>最长距离不超过16</li> <li>规定路由器不再把所收到的路由消息原路返还给发送端。这也 被称作水平分割（Split Horizon）</li> <li>“毒性逆转”（Poisoned Reverse）</li> <li>“触发更新”（Triggered Update）</li></ol> <h3 id="ospf-open-shortest-path-first"><a href="#ospf-open-shortest-path-first" class="header-anchor">#</a> OSPF:(Open Shortest Path First)</h3> <blockquote><p>是链路状态型路由协议, 生成网络拓扑信息再生成控制表.</p></blockquote> <h3 id="bgp-border-gateway-protocol"><a href="#bgp-border-gateway-protocol" class="header-anchor">#</a> BGP: (Border Gateway Protocol)</h3> <blockquote><p>属于EGP</p></blockquote> <h3 id="mpls-multi-protocol-label-switching"><a href="#mpls-multi-protocol-label-switching" class="header-anchor">#</a> MPLS: (Multi Protocol Label Switching)</h3> <blockquote><p>标记交换技术</p></blockquote> <h2 id="第八章-应用协议"><a href="#第八章-应用协议" class="header-anchor">#</a> 第八章: 应用协议</h2> <ol><li>登录协议: TELNET SSH</li> <li>文件传输: FTP协议</li> <li>电子邮件: SMTP(Simple Mail Transfer Protocol) 和POP/IMAP协议</li> <li>Web HTTP协议 JavaScript Cookie CGI规范 RSS数据格式</li> <li>网络管理 SNMP (Simple Network Management Protocol)</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/6/2022, 8:45:09 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/Internet/TCP&amp;IP/TCP.html" class="prev">
        TCP
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a976d4b9.js" defer></script><script src="/blog/assets/js/2.077fc20b.js" defer></script><script src="/blog/assets/js/17.710968ef.js" defer></script>
  </body>
</html>
